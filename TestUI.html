<!doctype html>
<html lang="zh-TW">
  <head>
    <base target="_top" />
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    <title>LINE Debugger Pro v3.6 (é›²ç«¯æ­·å² + å¿«é€Ÿå›è¦†)</title>

    <!-- å¼·åˆ¶ Mock æ©Ÿåˆ¶ -->
    <script>
      (function () {
        if (window.google && window.google.script && window.google.script.run)
          return;
        console.warn("ğŸš¨ [ç³»çµ±] å•Ÿç”¨ Mock æ¨¡å¼");
        window.isMockMode = true;
        window.google = {
          script: {
            run: {
              withSuccessHandler: function (fn) {
                this.success = fn;
                return this;
              },
              withFailureHandler: function (fn) {
                this.failure = fn;
                return this;
              },
              testMessage: function (msg) {
                setTimeout(() => {
                  if (this.success)
                    this.success({
                      success: true,
                      replies: [`[Mock] ${msg}`],
                      logs: [`[Mock Log] ${msg}`],
                    });
                }, 500);
              },
              clearTestSession: function () {
                setTimeout(() => {
                  if (this.success) this.success({ success: true });
                }, 500);
              },
              getCloudHistory: function () {
                setTimeout(() => {
                  if (this.success) this.success(["Mock1", "Mock2"]);
                }, 300);
              },
              saveCloudHistory: function () {
                // Mock save, do nothing
              },
            },
          },
        };
      })();
    </script>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --line-bg: #8c9daf;
        --user-msg: #95ec69;
        --bot-msg: #ffffff;
        --send-btn: #1e6be5;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        padding: 0;
        background-color: #202023;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: sans-serif;
        overflow: hidden;
      }
      .layout-container {
        display: flex;
        gap: 30px;
        height: 850px;
        max-height: 95vh;
        align-items: center;
      }

      /* æ‰‹æ©Ÿ */
      .phone-wrapper {
        width: 390px;
        height: 844px;
        background: #000;
        border-radius: 50px;
        padding: 12px;
        box-shadow: 0 0 0 2px #333;
        position: relative;
        flex-shrink: 0;
      }
      .notch {
        position: absolute;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        width: 150px;
        height: 30px;
        background: #000;
        border-radius: 0 0 16px 16px;
        z-index: 100;
      }
      .screen {
        width: 100%;
        height: 100%;
        background: var(--line-bg);
        border-radius: 40px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        position: relative;
      }
      .line-header {
        background: rgba(245, 245, 245, 0.95);
        padding: 45px 15px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #dcdcdc;
        z-index: 10;
      }
      .header-title {
        font-weight: bold;
        color: #333;
      }
      .mock-badge {
        background: #f44;
        color: #fff;
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 10px;
        display: none;
        margin-left: 5px;
      }

      #chat-box {
        flex: 1;
        padding: 20px 10px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
        scroll-behavior: smooth;
      }

      .msg-row {
        display: flex;
        align-items: flex-end;
        max-width: 100%;
        margin-bottom: 10px;
      }
      .msg-row.user {
        justify-content: flex-end;
      }
      .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #ddd
          url("https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg")
          center/cover;
        margin-right: 8px;
        flex-shrink: 0;
      }
      .msg-bubble {
        max-width: 70%;
        padding: 10px 14px;
        border-radius: 20px;
        font-size: 15px;
        line-height: 1.5;
        word-wrap: break-word;
        white-space: pre-wrap;
        box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
      }
      .msg-row.bot .msg-bubble {
        background: var(--bot-msg);
        border-top-left-radius: 4px;
        color: #000;
      }
      .msg-row.user .msg-bubble {
        background: var(--user-msg);
        border-top-right-radius: 4px;
        color: #000;
      }

      /* å¿«é€Ÿå›è¦†æŒ‰éˆ•ç¾¤çµ„ */
      .quick-reply-group {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        margin-top: 8px;
        max-width: 100%;
      }
      .quick-reply-btn {
        background: #007aff;
        color: #fff;
        border: none;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 12px;
        cursor: pointer;
        white-space: nowrap;
        transition: 0.2s;
      }
      .quick-reply-btn:hover {
        background: #0051d5;
      }
      .msg-row.bot .quick-reply-group {
        margin-left: 48px;
      }

      #queue-bar {
        background: rgba(0, 0, 0, 0.6);
        color: #fff;
        padding: 6px 15px;
        font-size: 11px;
        display: none;
        align-items: center;
        gap: 10px;
      }
      #queue-list {
        display: flex;
        gap: 6px;
        overflow-x: auto;
        flex: 1;
      }
      .queue-chip {
        background: #444;
        border-radius: 10px;
        padding: 2px 8px;
        white-space: nowrap;
        border: 1px solid #666;
      }

      .input-area {
        background: #fff;
        padding: 10px 15px 25px;
        display: flex;
        gap: 10px;
        border-top: 1px solid #eee;
      }
      #msg-input {
        flex: 1;
        padding: 10px 15px;
        border-radius: 20px;
        border: 1px solid #ddd;
        background: #f7f7f7;
        outline: none;
        font-size: 16px;
      }
      #send-btn {
        border: none;
        background: none;
        color: var(--send-btn);
        font-size: 24px;
        cursor: pointer;
      }

      /* æ§åˆ¶é¢æ¿ */
      .control-panel {
        width: 450px;
        height: 100%;
        background: #1e1e1e;
        border-radius: 16px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid #444;
        color: #ccc;
      }
      .panel-header {
        padding: 12px 15px;
        background: #252526;
        border-bottom: 1px solid #333;
        display: flex;
        justify-content: space-between;
        font-weight: bold;
      }
      .log-box {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
        color: #d4d4d4;
      }
      .log-line {
        border-bottom: 1px solid #333;
        padding-bottom: 2px;
        margin-bottom: 4px;
      }

      .history-panel {
        height: 250px;
        background: #252526;
        border-top: 1px solid #333;
        display: flex;
        flex-direction: column;
      }
      .history-content {
        padding: 10px;
        overflow-y: auto;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-content: flex-start;
      }
      .history-chip {
        background: #333;
        border: 1px solid #555;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 13px;
        cursor: pointer;
        transition: 0.2s;
      }
      .history-chip:hover {
        background: #444;
        color: #fff;
      }
      .history-chip.active {
        border-color: #06c755;
        color: #06c755;
      }

      .btn {
        background: #333;
        border: 1px solid #555;
        color: #ccc;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      .btn:hover {
        background: #444;
        color: #fff;
      }
      .btn-danger {
        background: #5a1e1e;
        border-color: #a00;
        color: #faa;
      }

      @media (max-width: 900px) {
        .layout-container {
          flex-direction: column;
          height: auto;
        }
        .phone-wrapper {
          width: 100%;
          height: 100vh;
          border-radius: 0;
        }
        .control-panel {
          width: 100%;
          height: 500px;
          border-radius: 0;
        }
      }
    
    /* Cost Guard Modal */
    .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:999; display:none; justify-content:center; align-items:center; }
    .modal-box { background:#252526; border:2px solid #ff4444; color:#fff; padding:20px; border-radius:10px; width:320px; text-align:center; box-shadow:0 0 20px rgba(255,0,0,0.2); }
    .modal-title { font-size:18px; font-weight:bold; color:#ff4444; margin-bottom:10px; }
    .modal-desc { font-size:14px; color:#ccc; margin-bottom:15px; background:#333; padding:10px; border-radius:5px; word-break:break-all; }
    .modal-timer { font-size:24px; font-weight:bold; color:#fff; margin:15px 0; }
    .modal-btns { display:flex; gap:10px; justify-content:center; }
    .modal-btn { padding:8px 20px; border:none; border-radius:5px; font-weight:bold; cursor:pointer; font-size:14px; }
    .btn-skip { background:#555; color:#ccc; }
    .btn-agree { background:#ff4444; color:#fff; }
  </style>
  </head>
  <body>
    <div class="layout-container">
      <div class="phone-wrapper">
        <div class="notch"></div>
        <div class="screen">
          <div class="line-header">
            <div class="header-title">
              ä¸‰æ˜Ÿè¢å¹•å°å¹«æ‰‹
              <span id="mock-badge" class="mock-badge">MOCK</span>
            </div>
          </div>
          <div id="chat-box"></div>
          <div id="queue-bar">
            <i class="fas fa-hourglass-half"></i>
            <div id="queue-list"></div>
          </div>
          <div class="input-area">
            <input
              type="text"
              id="msg-input"
              placeholder="Aa"
              onkeydown="checkEnter(event)"
            />
            <button id="send-btn" onclick="sendMessage()">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="control-panel">
        <div class="panel-header">
          <span>SYSTEM LOGS</span>
          <div style="display: flex; gap: 5px">
            <button class="btn" style="background:#0066cc;color:white;" onclick="loadBulkTest()">ğŸ“¥ è¼‰å…¥/æŒ‡å®š</button>
            <button class="btn" style="background:#cc6600;color:white;" onclick="stopQueue()">â¸ æš«åœ</button>
            <button class="btn btn-danger" onclick="addToQueue('/é‡å•Ÿ')">ğŸ”„ é‡å•Ÿ</button>
            <button class="btn" onclick="copyLogs()">è¤‡è£½</button>
            <button class="btn" onclick="clearLogUI()">æ¸…ç©º</button>
            <button class="btn btn-danger" onclick="clearSession()">
              é‡ç½®
            </button>
          </div>
        </div>
        <div id="log-box" class="log-box"></div>

        <div
          class="panel-header"
          style="border-top: 1px solid #333; margin-top: 0"
        >
          <span>é›²ç«¯æ­·å² (è‡ªå‹•åŒæ­¥)</span>
          <button class="btn" onclick="clearHistory()">æ¸…ç©ºæ­·å²</button>
        </div>
        <div class="history-panel">
          <div id="history-list" class="history-content"></div>
        </div>
      </div>
    </div>

<!-- Cost Guard Modal -->
<div id="cost-modal" class="modal-overlay">
  <div class="modal-box">
    <div class="modal-title">âš ï¸ é«˜æˆæœ¬æ“ä½œè­¦å‘Š</div>
    <div class="modal-desc" id="modal-msg">...</div>
    <div>å³å°‡è®€å– PDF (ç´„ NT$1.5)</div>
    <div class="modal-timer" id="modal-countdown">5</div>
    <div class="modal-btns">
      <button class="modal-btn btn-skip" onclick="resolveCostCheck(false)">è·³é (Skip)</button>
      <button class="modal-btn btn-agree" onclick="resolveCostCheck(true)">åŒæ„ (Run)</button>
    </div>
  </div>
</div>

<!-- Input Modal for Bulk Test -->
<div id="input-modal" class="modal-overlay">
  <div class="modal-box">
    <div class="modal-title">ğŸ“¥ è¼‰å…¥å£“åŠ›æ¸¬è©¦</div>
    <div class="modal-desc">è«‹è¼¸å…¥èµ·å§‹é¡Œè™Ÿ (1 - <span id="max-q">223</span>)</div>
    <input type="number" id="start-idx-input" value="1" style="width:80%;padding:10px;border-radius:5px;border:none;margin-bottom:15px;text-align:center;font-size:18px;">
    <div class="modal-btns">
      <button class="modal-btn btn-skip" onclick="closeInputModal()">å–æ¶ˆ</button>
      <button class="modal-btn btn-agree" onclick="confirmBulkTest()">é–‹å§‹</button>
    </div>
  </div>
</div>

    <script>
      // --- è®Šæ•¸ ---
      var messageQueue = [];
      var isBotProcessing = false;
      var defaultCmds = [
        "/é‡å•Ÿ",
        "/ç´€éŒ„ æ¸¬è©¦",
        "M8æœ‰è¦–è¨Šé¡é ­å—",
        "é‚£M9å‘¢",
        "M8æ€éº¼ç”¨",
        "3",
        "/loadBulkTest",
      ];
      var historyData = [];
      var currentQuickReplies = []; // å­˜å„²ç•¶å‰å¿«é€Ÿå›è¦†é¸é …

      // ğŸ”¥ 223 é¡Œå£“åŠ›æ¸¬è©¦é¡Œåº«
      const PRESET_QUESTIONS = [
        "G9æ²’æœ‰æ™ºæ…§è¯ç¶²çš„æ©Ÿå‹æ˜¯ï¼Ÿ",
        "æˆ‘å€‘æœ‰HD340HZï¼Œ4K200Hzçš„è¢å¹•å—",
        "è«‹å•s3æœ‰å–‡å­å—",
        "S27d300 gac",
        "S27f612 s27b610å·®åˆ¥",
        "çµ¦æˆ‘s27b610 è¦æ ¼",
        "è«‹å•æœ‰æ–°çš„s8å—ï¼Ÿ",
        "è«‹å•G5æœ‰é‚£äº›",
        "è«‹å•G5å“ªä¸€å°æ¯”è¼ƒå¥½",
        "è«‹å•S37D802 æœ‰æ™ºæ…§å—",
        "è«‹å•æœ‰G9çš„è³‡è¨Šå—ï¼Ÿ",
        "è«‹å•æœ‰S37D802 ç‰¹è‰²å—",
        "S27f532æ˜¯s27dg502æ›´æ–°ç‰ˆå—",
        "ç›®å‰æœ€æ–°çš„å‹è™Ÿæ˜¯å“ªæ¬¾è¢å¹•",
        "ä½ å¯ä»¥å‘Šè¨´æˆ‘G7çš„å‹è™Ÿæœ‰å“ªäº›",
        "ä½ å¯ä»¥å‘Šè¨´æˆ‘G5çš„å‹è™Ÿæœ‰å“ªäº›å—",
        "32å‹æ›²é¢è¢å¹•æœ‰é‚£äº›",
        "è«‹å•M7çš„é¢æ¿æ˜¯ç”šéº¼",
        "è«‹å•æœ‰2026æ–°æ©Ÿå‹å—ï¼Ÿ",
        "G8å¯ä»¥å£æ›å—",
        "G8ç›®å‰çš„åƒ¹æ ¼",
        "s34dg8ç›®å‰çš„åƒ¹æ ¼",
        "M8å¤šå°‘éŒ¢",
        "G9å¤šå°‘éŒ¢",
        "G5è¦æ ¼å¦‚ä½•",
        "é‚„æœ‰å…¶ä»–çš„g5å—",
        "g5æœ‰æ”¯æ´4Kå—",
        "å“ªä¸€æ¬¾g5æ˜¯4Kæˆ‘ä¸ç›¸ä¿¡",
        "S32FG502ç‰¹è‰²",
        "ä½ å€‘40å‹é‚£å°",
        "æˆ‘å¿˜äº†ï¼Œä½ å€‘æœ‰ä¸€å°æ˜¯40å‹çš„",
        "ä½ å€‘40å‹é‚£å°æ˜¯ä»€éº¼é¢æ¿",
        "å®ƒåŸºæœ¬è¦æ ¼æ˜¯ï¼Ÿ",
        "çµ¦æˆ‘G6æ‰€æœ‰å‹è™Ÿ",
        "å¸‚é¢ä¸ŠéŠ·å”®çš„ä¸‰æ˜ŸQD OLEDèˆ‡LGæ–°ä¸€ä»£çš„W OLEDé¢æ¿çš„æœ€å¤§å·®åˆ¥åœ¨å“ªï¼Ÿ å„ªç¼ºé»å„åœ¨å“ªï¼Ÿ",
        "æˆ‘çš„MACé›»è…¦åˆ°åº•æ‡‰è©²é¸ç”¨4Kè¢å¹•é‚„æ˜¯5Kè¢å¹•ï¼Ÿ å‚³è¼¸ç·šæ¥å£è©²å¦‚ä½•é¸ï¼Ÿ",
        "å¸‚é¢ä¸Šå‡ºç¾è¨±å¤šé›™æ¨¡çš„é¡¯ç¤ºå™¨èˆ‡ä¸»æµçš„é¡¯ç¤ºå™¨å·®åˆ¥æ˜é¡¯å—ï¼Ÿ æœ‰ä»€éº¼å„ªç¼ºé»å—ï¼Ÿ",
        "ä»€éº¼æ˜¯HDR",
        "HDR10çš„å„ªé»æœ‰ä»€éº¼ï¼Ÿ",
        "è«‹å•æ™ºæ…§é¡¯ç¤ºå™¨æœ‰ç”šéº¼ç‰¹è‰²",
        "smart monitor çš„M9å’ŒM8æœ€ä¸»è¦å·®ç•°æ˜¯ä»€éº¼",
        "m7å’Œs7æœ‰ä»€éº¼ä¸åŒ",
        "oledæ–‡å­—æœƒä¸å¥½çœ‹",
        "æˆ‘è²·çš„ä¸‰æ˜ŸG6æ˜¯å—",
        "s27fg602sc",
        "ä½†æ˜¯å®ƒæ–‡å­—é¡¯ç¤ºä¸å¥½çœ‹",
        "m7å’Œm8æœ‰ä»€éº¼å·®åˆ¥",
        "m7ä¹Ÿæ”¯æ´iotæ§åˆ¶å§",
        "æˆ‘ç”¨odyssey hubé»é¸éŠæˆ²å¾Œï¼ŒéŠæˆ²è¢«é–‹åœ¨å¾Œæ–¹ä¸¦ä¸”æ²’æœ‰å‘ˆç¾3Dï¼Œä½†æˆ‘çœ‹å½±ç‰‡æ˜¯å¯ä»¥çš„",
        "è«‹å•PINå¿˜è¨˜æ€éº¼åŠ",
        "smartè¢å¹•å…§å»ºçš„ç€è¦½å™¨å¯ä»¥ä¸€ç›´å…¨è¢å¹•é¡¯ç¤ºç¶²é å…§å®¹å—",
        "ä¸‰æ˜Ÿsmartçš„ç€è¦½å™¨å¯ä»¥é–‹å•Ÿæ™‚å°±æ˜¯å…¨è¢å¹•å—",
        "ä¸‰æ˜Ÿè¢å¹•ç€è¦½å™¨å¦‚ä½•è¨­å®šå…¨è¢å¹•ï¼Ÿ",
        "M7è£¡çš„ç€è¦½å™¨å¯ä»¥å…¨è¢å¹•é¡¯ç¤ºå—",
        "é‚£Smart è¢å¹•å‘¢",
        "è«‹å•s27fg532 ç‚ºä»€éº¼å®¢äººçš„é¡¯ç¤ºå¡5090æ¥dpä»–çš„æ›´æ–°ç‡åªæœ‰60",
        "æˆ‘ç”¨Odyssey Hubé–‹å•ŸéŠæˆ²ä½†éŠæˆ²è¦–çª—æœƒé–‹åœ¨èƒŒæ™¯ä¸¦ä¸”æ²’æœ‰é¡¯ç¤º3Dè€¶ï¼Ÿæˆ‘çœ‹å½±ç‰‡æ˜¯å¯ä»¥3Dçš„",
        "éŠæˆ²ä¼¼ä¹ä¸€ç›´è¢«é–‹åœ¨odyssey hubä¹‹ä¸‹",
        "è¦æ€éº¼é–‹å•Ÿå‘¢",
        "LS27C900 5Ké€™å°èƒ½æ¥thunderbolt 4åˆ°5Kå—ï¼Ÿ",
        "å¯æ˜¯æˆ‘æ¥ä¸Šå»åªæœ‰åˆ°4Kæ€éº¼è¾¦ï¼Ÿ",
        "æ‰‹å†Šè£¡æœ‰å¯«åˆ°é€™å°è¢å¹•æœ‰é™å®šä»€éº¼è¦æ ¼ä»¥ä¸Šçš„macæ‰èƒ½5Kå—ï¼Ÿ",
        "èƒ½ä¸èƒ½é€²ä¸€æ­¥æŸ¥è©¢ä»€éº¼æ˜¯ä½ å£ä¸­çš„è¼ƒèˆŠçš„macã€éƒ¨åˆ†èˆŠæ¬¾macï¼Œåˆ°åº•æ˜¯å“ªäº›æˆ–æ˜¯è¦æ ¼ä¸Šçš„åˆ†æ°´å¶º",
        "å®ƒè¦æ€éº¼é–‹å•ŸéŠæˆ²æ¨¡å¼",
        "è¦æ€éº¼èª¿æ•´144Hz",
        "å®ƒçš„é›»ç«¶æ¨¡å¼è¦æ€éº¼é–‹å‘¢",
        "m7æœƒé–ƒå±æ€éº¼è¾¦",
        "æˆ‘æ˜¯ç”¨type cæ¥çš„",
        "å®ƒçš„smart æ“æ§è¦æ€éº¼ä½¿ç”¨å‘¢",
        "æˆ‘ä¸‹è¼‰äº†ä½†è¦æ€éº¼ç”¨å‘¢",
        "m7å¦‚ä½•é€£æ¥macbooké¡¯ç¤º",
        "å¯æ˜¯å®ƒç¾åœ¨ç„¡æ³•é¡¯ç¤ºè€¶ï¼",
        "æˆ‘m8çš„è¦–è¨Šé¡é ­è¦æ€éº¼ä½¿ç”¨æ‰èƒ½è®“é›»è…¦çš„google meetæœ‰å®ƒçš„ç•«é¢",
        "G6èƒŒå¾Œæœ‰æ°›åœç‡ˆç’°å—ï¼Ÿ",
        "é‚£fg606å‘¢",
        "fg602å‘¢",
        "é‚£ dg612å‘¢",
        "G6æœ‰Infinity Core Lightingå—ï¼Ÿ",
        "arkçš„å­”è·æ˜¯å¤šå°‘",
        "å¯ä»¥400x400å—",
        "G6æœ‰èƒŒå¾Œç’°å‹ç‡ˆå—",
        "4æœ‰ç’°å‹å—",
        "å¿«é€Ÿæ¸…æ´—æ˜¯ä»€éº¼æ„æ€",
        "æ´—è¡£æ©Ÿçš„å¼·åŠ›æ´—æ·¨å’Œä¸€èˆ¬æ´—æœ‰ä»€éº¼ä¸ä¸€æ¨£",
        "å®ƒçš„å¼·åŠ›æ´—æ·¨å’Œä¸€èˆ¬æ´—æœ‰ä»€éº¼ä¸ä¸€æ¨£",
        "æˆ‘æ¯æ¬¡æ´—å®Œè¡£æœï¼Œä¸Šè“‹æ˜¯ä¸æ˜¯è©²é–‹è‘—ä¸€æ™šç¬¬äºŒå¤©å†é—œï¼Œæ¯”è¼ƒä¸å®¹æ˜“æ»‹ç”Ÿé»´èŒ",
        "æˆ‘æ´—è¡£æ©Ÿæ´—å¥½å¾Œä¸Šè“‹æ‡‰è©²é–‹ä¸€æ™šè®“å®ƒæ´—è¡£æ§½é¢¨ä¹¾å—",
        "è«‹å•m7 43å‹è€—é›»é‡å¤šå¤§",
        "è«‹å•æœå‹™æ™‚é–“æ˜¯å¹¾é»",
        "è«‹å•å°ä¸­å“ªè£¡æœ‰followme çš„å±•ç¤º",
        "è«‹å•æœ‰é›™12å„ªæƒ å—ï¼Ÿ",
        "é›™11å„ªæƒ å‘¢",
        "ä»Šå¤©é»‘äº”æœ‰ç‰¹åƒ¹å—",
        "è«‹å•æœ€è¿‘æœ‰æ´»å‹•å—",
        "è«‹å•æœ‰æ•™è‚²è¨“ç·´å—ï¼Ÿ",
        "è«‹å•ç›®å‰éŠ·å”®é€šè·¯æœ‰é‚£äº›",
        "è«‹å•é€™å­£æœ‰ç”šéº¼æ´»å‹•å—ï¼Ÿ",
        "è«‹å•æœ‰æ»¿é¡æŠ½çå—ï¼Ÿ",
        "å»¶é•·ä¿å›ºçš„éƒ¨åˆ†",
        "è«‹å•ä»Šå¤©æœ‰12æœˆçš„æ´»å‹•è³‡è¨Šå—",
        "æœ¬æœˆæœ‰ä¿ƒéŠ·å„ªæƒ å—",
        "è«‹å•ä»Šå¤©æœ‰ç‡Ÿæ¥­å—ï¼Ÿ",
        "å®¢æˆ¶åæ‡‰43å‹follow me Proçš„æ”¯æ¶æœ‰æˆ‘å€‘æœ‰ä¿å›ºå—",
        "è«‹å•G8 åŠ 2å¹´ äº®é»ä¹Ÿæœ‰ä¿å›ºå—",
        "è«‹å•æœ‰12æœˆçš„ä¿ƒéŠ·è¨Šæ¯å—ï¼Ÿ",
        "é †ç™¼é€šè·¯æœ‰è²©å”®27å‹oLEDçš„è¢å¹•å—",
        "smartçš„é›¶å”®æ¨¡å¼çš„epopæ€éº¼æ›´æ–°",
        "å®ƒå±•ç¤ºæ¨¡å¼çš„epopæ€éº¼æ›´æ–°",
        "S43FM703UCXå¦‚ä½•é–‹å•Ÿé›¶å”®æ¨¡å¼",
        "ç¶²è·¯æŸ¥ä¸€ä¸‹æœ€è¿‘ä¸‰æ˜Ÿceså±•çš„",
        "è¢å¹•çš„éƒ¨åˆ†å‘¢",
        "æœ‰å§ï¼6K3Dæ¬¾éƒ½å‡ºä¾†äº†ï¼",
        "æœƒæœ‰ç¬¬äºŒä»£3Dè¢å¹•å—",
        "å°ç£æœƒä¸Šå¸‚å—",
        "åªé‡å°é€™é»å¹«æˆ‘æ‡‰å°ï¼Œæœ‰æ†‘æœ‰æ“šï¼Œä¸è¦æ”»æ“ŠLG 2026 OLED",
        "ä»Šå¹´æƒ³æ¡è³¼Galaxy Watch ä¸»è¦çœ‹ä¸Šæ”¯ä»˜æ–¹å¼çš„æ–¹ä¾¿æ€§ï¼Œé‚£æƒ³è«‹å•è·Ÿæ™ºæ…§éŠ€å¹•é—œè¯çš„éƒ¨åˆ†",
        "å°ç£å±¬æ–¼ä¸­åœ‹çš„å—",
        "ç¶²è·¯æœå°‹ä»Šæ—¥å°ç£æ–°èé ­æ¢",
        "æˆ‘çš„ä¸»æ©Ÿæ­é…äº†5060çš„é¡¯å¡å¦‚æœæ¡ç”¨27å‹è¢å¹•ã€‚ ä½ æœƒæ¨è–¦ä¸‰æ˜Ÿå“ªæ¬¾çš„è¢å¹•ï¼Ÿ ç‚ºä»€éº¼ï¼Ÿ",
        "æˆ‘æƒ³å¹«æˆ‘çš„è˜‹æœMACé›»è…¦é¸è³¼ä¸€å°27å‹çš„è¢å¹•ï¼Œä½ æœƒå»ºè­°è³¼è²·S27C900PAC 5Ké‚„æ˜¯S27FG602SC 4K OLEDï¼Ÿ ç‚ºä»€éº¼ï¼Ÿ",
        "ä»¥è¡¨æ ¼excelæ–¹å¼åˆ—å‡ºï¼Œå¸‚å”®è¯ç¢©ã€æŠ€å˜‰åŠå¾®æ˜Ÿ32å‹é¡¯ç¤ºå™¨å…·å‚™é«˜åˆ·æ–°ç‡åŠé«˜è§£æåº¦ï¼Œä¸”å…·å‚™Type-C å½±åƒæ•¸æ“šå‚³è¼¸ä»‹é¢çš„æ©Ÿå‹æœ‰é‚£å¹¾æ¬¾ï¼Œç›®å‰å”®åƒ¹ç‚ºå¤šå°‘ã€‚",
        "Odyssey Ark ç¬¬äºŒä»£ G97NC æœ‰æ”¯æ´ KVM åˆ‡æ›åŠŸèƒ½å—",
        "è«‹å• S55CG970NC çš„åº§è‰™æ¨¡å¼è¦æ€éº¼æ—‹è½‰æ‰ä¸æœƒæ’åˆ°æ¡Œé¢",
        "Odyssey OLED G9 S49CG954SC çš„è¢å¹•æ¯”ä¾‹æ˜¯ä¸‰åäºŒæ¯”ä¹å—",
        "è«‹å• 57 å‹çš„ Neo G9 G95NC æ”¯æ´é›™ 4K è¼¸å‡ºå—",
        "æˆ‘çš„ Odyssey G8 S34DG852SC æ¥ä¸Š PS5 ç‚ºä»€éº¼æ²’è¾¦æ³•é–‹å•Ÿ 120Hz",
        "è«‹å• S32DG802SC é€™æ¬¾ 32 å‹ OLED G8 æœ‰å…§å»ºæ™ºæ…§é›»è¦–åŠŸèƒ½å—",
        "Odyssey G7 G70B çš„é™æ§å™¨è¦æ€éº¼è·Ÿè¢å¹•é‡æ–°é…å°",
        "è«‹å• S27DG602SC çš„åæ‡‰æ™‚é–“ 0.03ms æ˜¯æŒ‡å“ªç¨®è¦æ ¼",
        "Odyssey G5 S32CG552EC çš„ 1000R æ›²ç‡æ˜¯ä»€éº¼æ„æ€",
        "æˆ‘çš„ S27CG512NC æ›´æ–°ç‡æœ€é«˜å¯ä»¥èª¿æ•´åˆ° 165Hz å—",
        "è«‹å• Odyssey Ark çš„è½‰ç›¤æ§åˆ¶å™¨ Ark Dial è¦æ€éº¼å……é›»",
        "OLED G9 çš„é˜²ç‡’å±æ©Ÿåˆ¶èƒ½åœ¨é¸å–®çš„å“ªè£¡èª¿æ•´",
        "è«‹å• S49DG952SC æ”¯æ´ä¸‰æ˜Ÿçš„ AI å½±åƒå¢å¼·æŠ€è¡“å—",
        "Odyssey G6 S27BG650EC å…§å»ºçš„æšè²å™¨æ˜¯å¤šå°‘ç“¦æ•¸çš„",
        "è«‹å• G5 ç³»åˆ—çš„ S27CG552EC æœ‰æ”¯æ´ AMD FreeSync Premium å—",
        "ç‚ºä»€éº¼æˆ‘çš„ Odyssey è¢å¹•èƒŒé¢ç‡ˆç’°ä¸æœƒäº®",
        "è«‹å• S57CG952NC éš¨æ©Ÿé™„è´ˆçš„ç·šææœ‰å“ªäº›",
        "Odyssey Ark æ”¯æ´å¤šé‡è¦–çª—åŠŸèƒ½åŒæ™‚é¡¯ç¤ºå¹¾å€‹è¨Šè™Ÿæº",
        "è«‹å• S32BG850NC å…·å‚™é‡å­é»çŸ©é™£æŠ€è¡“å—",
        "Odyssey G3 S24AG320NC çš„æ”¯æ¶å¯ä»¥èª¿æ•´é«˜åº¦å—",
        "è«‹å• S27DG602SC æ”¯æ´ VESA å£æ›æ¨™æº–å—",
        "æˆ‘çš„ OLED G9 ç•«é¢å‡ºç¾æ®˜å½±è¦æ€éº¼åŸ·è¡Œåƒç´ é‡æ–°æ•´ç†",
        "è«‹å• Odyssey G7 æ”¯æ´ NVIDIA G-Sync ç›¸å®¹æŠ€è¡“å—",
        "Odyssey Ark çš„ä¸€å°å¤šæ§åˆ¶å™¨å¯ä»¥æ“ä½œå…¶ä»–ä¸‰æ˜Ÿç”¢å“å—",
        "è«‹å• S49CG954SC æœ‰å…§å»ºè—ç‰™åŠŸèƒ½å—",
        "Smart Monitor M8 S32DM801UC æœ‰é™„è´ˆ SlimFit è¦–è¨Šé¡é ­å—",
        "è«‹å• M7 S43DM702UC æ”¯æ´æ™ºæ…§æ‰‹éŒ¶é—œè¯é¡¯ç¤ºåŠŸèƒ½å—",
        "æˆ‘çš„ M5 S27CM501EC å¯ä»¥ä¸ç”¨æ¥é›»è…¦ç›´æ¥çœ‹ Disney+ å—",
        "Smart Monitor å…§å»ºçš„ Bixby èªéŸ³åŠ©æ‰‹ç¾åœ¨æ”¯æ´ä¸­æ–‡äº†å—",
        "è«‹å• M80D èˆ‡ M80C çš„ä¸»è¦è¦æ ¼å·®ç•°åœ¨å“ªè£¡",
        "S32BM703UC çš„ USB C æ¥å£å¯ä»¥å¹«æˆ‘çš„ç­†é›»é€²è¡Œ 65W å……é›»å—",
        "ç‚ºä»€éº¼æˆ‘çš„æ™ºæ…§è¢å¹•ä½¿ç”¨ AirPlay é€£ç·šæ™‚ç•«é¢æœƒå»¶é²",
        "è«‹å• Smart Monitor ç³»åˆ—å¯ä»¥å®‰è£å®‰å“å°ˆç”¨çš„ APK æª”æ¡ˆå—",
        "æˆ‘çš„ S32DM803UC å‡ºç¾è‡ªå‹•ä¾†æºåˆ‡æ›åŠŸèƒ½è¦æ€éº¼é—œé–‰",
        "è«‹å• M7 ç³»åˆ—æœ‰ 32 å‹çš„å‹è™Ÿå¯ä»¥é¸æ“‡å—",
        "Smart Monitor çš„é™æ§å™¨å¦‚æœæ˜¯å¤ªé™½èƒ½ç‰ˆæœ¬è¦æ€éº¼è“„é›»",
        "è«‹å•æ™ºæ…§è¢å¹•å¯ä»¥ç•¶ä½œ SmartThings çš„ä¸­æ§æ¨ç´å—",
        "æˆ‘çš„ M8 é¡é ­å¸ä¸Šå»å¾Œè¦–è¨Šè»Ÿé«”æŠ“ä¸åˆ°ç•«é¢æ€éº¼æ’è§£",
        "è«‹å• M5 ç³»åˆ—æœ‰æ”¯æ´é ç«¯æ¡Œé¢é€£æ¥ MacBook çš„åŠŸèƒ½å—",
        "æ™ºæ…§è¢å¹•å¿˜è¨˜å››ä½æ•¸ PIN ç¢¼è¦æ€éº¼é ç«¯é‡è¨­",
        "è«‹å• S32DM801UC æ”¯æ´ HDR10+ è¦æ ¼å—",
        "Smart Monitor å…§å»ºçš„ç¶²éš›ç¶²è·¯ç€è¦½å™¨å¯ä»¥å¤–æ¥éµç›¤æ»‘é¼ å—",
        "è«‹å• M7 S32DM702UC æœ‰å…§å»ºæ•¸ä½é›»è¦–èª¿è«§å™¨å—",
        "ç‚ºä»€éº¼æˆ‘çš„æ™ºæ…§è¢å¹•åœ¨é—œæ©Ÿå¾Œ USB æ¥å£é‚„åœ¨ä¾›é›»",
        "è«‹å• M8 çš„åº•åº§å¯ä»¥èª¿æ•´ä¸Šä¸‹é«˜åº¦èˆ‡å‚¾æ–œè§’åº¦å—",
        "ViewFinity S9 S27C900PAC çš„è¢å¹•è§£æåº¦æ˜¯ 5K å—",
        "è«‹å• S27C900PAC æ¥ Windows é›»è…¦å¯ä»¥è·‘åˆ°æ»¿è§£æåº¦å—",
        "ViewFinity S8 S32B800PXC çš„é¡¯è‰²æœ‰é€šé Pantone èªè­‰å—",
        "è«‹å• S27B800PXC é©åˆç”¨ä¾†åšå°ˆæ¥­æ ¡è‰²æˆ–å°åˆ·æ’ç‰ˆå—",
        "ViewFinity S6 S34C650UCC é€™å°æ›²é¢è¢å¹•æœ‰æ”¯æ´ç¶²è·¯å­”å—",
        "è«‹å• Essential S3 S24C310EAC é€™æ¬¾è¢å¹•æœ‰ä¸é–ƒå±æŠ€è¡“å—",
        "ViewFinity ç³»åˆ—çš„è¢å¹•æœ‰æ²’æœ‰å…§å»ºå–‡å­æˆ–æ˜¯è€³æ©Ÿå­”",
        "è«‹å• S32A700NW æ”¯æ´ USB C ä¸€ç·šé€£æ¥å½±åƒå‚³è¼¸å—",
        "ViewFinity S9 çš„æ ¡è‰²åŠŸèƒ½è¦æ­é…å“ªä¸€æ¬¾æ‰‹æ©Ÿ App ä½¿ç”¨",
        "è«‹å• S27C900PAC çš„è¢å¹•è¡¨é¢æ˜¯äº®é¢é‚„æ˜¯éœ§é¢åŠ å·¥",
        "ViewFinity S5 S34C500GAC çš„è¶…å¯¬è¢å¹•æ”¯æ´ PBP ç•«é¢åˆ†å‰²å—",
        "è«‹å• S32B800PXC çš„æ”¯æ¶å¯ä»¥æ—‹è½‰æˆç›´ç«‹æ–¹å‘å—",
        "æˆ‘çš„ ViewFinity è¢å¹•å‡ºç¾ç´°å¾®æ®˜å½±é€™å±¬æ–¼é¢æ¿ç•°å¸¸å—",
        "è«‹å•ä¸‰æ˜Ÿå°ˆæ¥­è¢å¹•çš„è­·çœ¼æ¨¡å¼è¦åœ¨å“ªè£¡é–‹å•Ÿ",
        "Essential ç³»åˆ—çš„ S27C310EAC æ›´æ–°ç‡æœ€é«˜æ˜¯å¤šå°‘",
        "è«‹å•ä¸‰æ˜Ÿè¢å¹•çš„ä¿å›ºæœŸä¸€èˆ¬æ˜¯å¹¾å¹´",
        "ä¸‰æ˜Ÿè¢å¹•çš„äº®é»ä¿å›ºè¦ç¯„æ˜¯æ€éº¼å®šç¾©çš„",
        "è«‹å•å“ªäº›å‹è™Ÿçš„ä¸‰æ˜Ÿè¢å¹•æœ‰æ”¯æ´è‡ªå‹•è¨Šè™Ÿæºåˆ‡æ›åŠŸèƒ½",
        "æˆ‘çš„ç­†é›»åªæœ‰ HDMI æ¥å£å¯ä»¥æ¥åˆ° 240Hz è¢å¹•ä¸Šå—",
        "ä¸‰æ˜Ÿè¢å¹•çš„éŠæˆ²åˆ— Game Bar 3.0 è¦æ€éº¼å«å‡ºä¾†",
        "è«‹å• VESA å£æ›å­”è· 100x100 èˆ‡ 200x200 æ€éº¼å€åˆ†",
        "ä»€éº¼æ˜¯è¶…å¯¬éŠæˆ²è¦–é‡ Ultrawide Game View åŠŸèƒ½",
        "æˆ‘çš„æ™ºæ…§è¢å¹• WiFi è¨Šè™Ÿä¸ç©©è¦æ€éº¼é‡ç½®ç¶²è·¯è¨­å®š",
        "è«‹å•è¢å¹•éŸŒé«”æ›´æ–°ä¸€å®šè¦ä½¿ç”¨ USB éš¨èº«ç¢Ÿå—",
        "ä¸‰æ˜Ÿé›»ç«¶è¢å¹•çš„ 1ms GtG èˆ‡ 1ms MPRT æœ‰ä»€éº¼å·®åˆ¥",
        "è«‹å•å“ªäº›ä¸‰æ˜Ÿè¢å¹•æœ‰å…§å»ºæ¸›å°‘è—å…‰é–ƒçˆçš„èªè­‰",
        "æˆ‘çš„è¢å¹•æ¥ä¸Š PS5 å¾Œ HDR é¸é …æ‰“ä¸é–‹æ˜¯ä»€éº¼åŸå› ",
        "ä¸‰æ˜Ÿæ›²é¢è¢å¹• 1000R è·Ÿ 1800R å“ªä¸€å€‹å½æ›²ç¨‹åº¦æ¯”è¼ƒå¤§",
        "è«‹å• S27DG602SC çš„åŸç”Ÿé‡æ–°æ•´ç†é »ç‡æ˜¯å¤šå°‘",
        "ç‚ºä»€éº¼æˆ‘çš„è¢å¹•é‚Šæ¡†æœ‰ä¸€å±¤è–„è†œå¯ä»¥æ’•æ‰å—",
        "è«‹å•ä¸‰æ˜Ÿè¢å¹•æœ‰æ²’æœ‰æ”¯æ´é»‘å¹³è¡¡å‹•æ…‹èª¿æ•´åŠŸèƒ½",
        "è¢å¹•é¸å–®è£¡çš„å›æ‡‰æ™‚é–“åˆ†ç´šè¨­å®šä»£è¡¨ä»€éº¼æ„æ€",
        "è«‹å•ä¸‰æ˜Ÿè¢å¹•æ”¯æ´ HDR400 è·Ÿ HDR1000 æ•ˆæœå·®å¾ˆå¤šå—",
        "æˆ‘çš„è¢å¹•ç•«é¢é¡è‰²çœ‹èµ·ä¾†é»ƒé»ƒçš„æ˜¯ä¸æ˜¯è¨­å®šåˆ°äº†è­·çœ¼æ¨¡å¼",
        "è«‹å•ä¸‰æ˜Ÿæœ‰å‡º 24 å‹ä¸¦ä¸”æ”¯æ´ 144Hz çš„é›»ç«¶è¢å¹•å—",
        "ç¾åœ¨è²· Odyssey OLED G9 æœ‰é€ä»€éº¼é™å®šè´ˆå“å—",
        "è«‹å•ä¸‰æ˜Ÿå®˜ç¶²çš„æ•™è‚²å„ªæƒ å°ˆæ¡ˆé›»è…¦è¢å¹•æœ‰æŠ˜æ‰£å—",
        "å°ä¸­å“ªè£¡æœ‰å¯¦é«”åº—é¢å¯ä»¥çœ‹ Odyssey Ark çš„å±•ç¤ºæ©Ÿ",
        "è«‹å•ç¾åœ¨é‚„æœ‰é›™ 11 çš„å„ªæƒ ä¿ƒéŠ·åƒ¹æ ¼å—",
        "ä¸‰æ˜Ÿè¢å¹•å¦‚æœéäº†ä¿å›ºæœŸç¶­ä¿®è²»å¤§ç´„æ˜¯å¤šå°‘éŒ¢",
        "è«‹å•ä¸‰æ˜Ÿå®˜ç¶²è²·è¢å¹•æœ‰åŒ…å«æ¡Œä¸ŠåŸºæœ¬å®‰è£æœå‹™å—",
        "åœ¨ç‡¦å¤æˆ–é †ç™¼è²·çš„ä¸‰æ˜Ÿè¢å¹•ä¿å›ºä¹Ÿæ˜¯æ‰¾åŸå» å—",
        "è«‹å•é€™å­£çš„æ˜Ÿå­¸åŠ›æ´»å‹•æœ‰å“ªäº›è¢å¹•åƒåŠ ç‰¹åƒ¹",
        "æ»¿é¡æŠ½çæ´»å‹•çš„ç™¼ç¥¨ç™»éŒ„ç¶²å€åœ¨å“ªè£¡",
        "è«‹å•ä¸‰æ˜Ÿé›»è…¦è¢å¹•æœ‰æä¾›å»¶é•·ä¿å›ºçš„åŠ è³¼æœå‹™å—",
        "è«‹å•ä¸‰æ˜Ÿ Galaxy S24 Ultra æ‰‹æ©Ÿç¾åœ¨ç©ºæ©Ÿå¤šå°‘éŒ¢",
        "æˆ‘çš„ä¸‰æ˜Ÿæ´—è¡£æ©Ÿè„«æ°´æ™‚è²éŸ³å¾ˆå¤§è©²æ€éº¼è§£æ±º",
        "è«‹å•é€™å°è¢å¹•å¯ä»¥æ¥ä¸‰æ˜Ÿçš„å†°ç®±çœ‹è£¡é¢çš„é£Ÿæå—",
        "ä½ è¦ºå¾—ä¸‰æ˜Ÿçš„æ‰‹æ©Ÿæ¯”è¼ƒå¥½é‚„æ˜¯è˜‹æœçš„æ‰‹æ©Ÿæ¯”è¼ƒå¥½",
        "å¹«æˆ‘æŸ¥è©¢ä»Šå¤©å°åŒ—åˆ°é«˜é›„çš„é«˜éµæ™‚åˆ»è¡¨",
        "è«‹å•ä¸‰æ˜Ÿé›»è¦– QN90D çš„è…³æ¶è·Ÿé›»è…¦è¢å¹•æ˜¯ä¸€æ¨£çš„å—",
        "æˆ‘çš„ä¸‰æ˜Ÿç­†é›»éµç›¤å£äº†è«‹å•è¦å»å“ªè£¡ç¶­ä¿®",
        "è«‹å•ä¸‰æ˜Ÿçš„å»šå…·ç³»åˆ—åœ¨å°ç£æœ‰æ­£å¼è²©å”®å—",
        "å°ç£ç¾åœ¨çš„ç¸½çµ±æ˜¯èª°",
        "å¹«æˆ‘æœå°‹æœ€è¿‘æœ‰ä»€éº¼å¥½çœ‹çš„éŸ“åŠ‡æˆ–æ˜¯ç†±é–€é›»å½±æ¨è–¦",
      ];

      // --- åˆå§‹åŒ– ---
      window.onload = function () {
        if (window.isMockMode)
          document.getElementById("mock-badge").style.display = "inline-block";

        // 1. å¾å¾Œç«¯è¼‰å…¥æ­·å²ç´€éŒ„
        loadCloudHistory();

        // 2. è‡ªå‹•é‡å•Ÿ
        addToQueue("/é‡å•Ÿ");
      };

      // --- é›²ç«¯æ­·å²ç³»çµ± ---
      function loadCloudHistory() {
        // é¡¯ç¤ºè¼‰å…¥ä¸­...
        document.getElementById("history-list").innerHTML =
          '<div style="color:#888;font-size:12px;">è¼‰å…¥é›²ç«¯ç´€éŒ„ä¸­...</div>';

        google.script.run
          .withSuccessHandler(function (data) {
            if (data && data.length > 0) {
              historyData = data;
            } else {
              historyData = [...defaultCmds];
            }
            renderHistory();
          })
          .withFailureHandler(function (err) {
            console.error("ç„¡æ³•è¼‰å…¥æ­·å²:", err);
            historyData = [...defaultCmds]; // å¤±æ•—å‰‡ç”¨é è¨­å€¼
            renderHistory();
          })
          .getCloudHistory();
      }

      function saveCloudHistory() {
        // ç‚ºäº†æ•ˆèƒ½ï¼Œä¸è¦æ¯æ¬¡æ‰“å­—éƒ½å­˜ï¼Œå‰ç«¯å…ˆæ›´æ–° UI
        // å¾Œç«¯éåŒæ­¥å„²å­˜
        google.script.run.saveCloudHistory(historyData);
        renderHistory();
      }

      function addToHistory(text) {
        // é¿å…é‡è¤‡ï¼Œç§»åˆ°æœ€å‰
        historyData = historyData.filter((item) => item !== text);
        historyData.unshift(text);
        if (historyData.length > 30) historyData.pop();

        renderHistory();
        saveCloudHistory(); // è§¸ç™¼é›²ç«¯å„²å­˜
      }

      function clearHistory() {
        if (!confirm("æ¸…é™¤æ‰€æœ‰é›²ç«¯æ­·å²ç´€éŒ„ï¼Ÿ")) return;
        historyData = [...defaultCmds];
        renderHistory();
        saveCloudHistory();
      }

      function renderHistory() {
        var container = document.getElementById("history-list");
        container.innerHTML = "";
        historyData.forEach((text) => {
          var chip = document.createElement("div");
          chip.className = "history-chip";
          chip.innerText = text;
          chip.onclick = function () {
            chip.classList.add("active");
            setTimeout(() => chip.classList.remove("active"), 200);
            addToQueue(text);
          };
          container.appendChild(chip);
        });
      }

      function loadBulkTest() {
        // Update Max Count UI
        document.getElementById("max-q").innerText = PRESET_QUESTIONS.length;
        document.getElementById("start-idx-input").value = "1";
        document.getElementById("input-modal").style.display = "flex";
      }

      function closeInputModal() {
        document.getElementById("input-modal").style.display = "none";
      }

      function confirmBulkTest() {
        var input = document.getElementById("start-idx-input").value;
        var idx = parseInt(input);
        
        if (isNaN(idx) || idx < 1 || idx > PRESET_QUESTIONS.length) {
          alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­— (1-" + PRESET_QUESTIONS.length + ")");
          return;
        }
        
        closeInputModal(); // Close modal first

        if(!confirm("ç¢ºå®šè¦å¾ç¬¬ " + idx + " é¡Œé–‹å§‹ï¼Œè¼‰å…¥ " + (PRESET_QUESTIONS.length - idx + 1) + " é¡Œå—ï¼Ÿ\n(å°‡èŠ±è²»è²»ç”¨)")) return;
        
        // Add sliced questions to queue
        var questions = PRESET_QUESTIONS.slice(idx - 1);
        questions.forEach(q => {
          messageQueue.push(q);
        });
        
        renderQueue();
        if (!isBotProcessing) processQueue();
      }

      function stopQueue() {
        if(messageQueue.length === 0) return;
        if(!confirm("ç¢ºå®šè¦æš«åœä¸¦æ¸…ç©ºå‰©é¤˜çš„ " + messageQueue.length + " é¡Œæ’ç¨‹å—ï¼Ÿ")) return;
        messageQueue = [];
        renderQueue();
        // Note: The CURRENTLY processing message will still finish/reply.
      }

      // --- è¨Šæ¯ç™¼é€ ---
      function sendMessage() {
        var input = document.getElementById("msg-input");
        var text = input.value.trim();
        if (!text) return;
        addToQueue(text);
        addToHistory(text); // å­˜å…¥æ­·å²
        currentQuickReplies = []; // æ¸…é™¤èˆŠå¿«é€Ÿå›è¦†
        input.value = "";
      }

      function addToQueue(text) {
        if (!text) return;
        messageQueue.push(text);
        renderQueue();
        processQueue();
      }

      function processQueue() {
    if (isBotProcessing || messageQueue.length === 0) return;
    var nextMsg = messageQueue[0]; // Peek first, remove only if processed/skipped
    
    // Check cost first
    checkAndSend(nextMsg);
  }
  
  // --- Cost Guard Logic ---
  var costCheckTimer = null;
  
  function checkAndSend(text) {
    isBotProcessing = true; // Lock queue
    
    google.script.run
      .withSuccessHandler(function(result) {
        if (!result.isHighCost) {
           // Safe to send
           messageQueue.shift(); // Remove from queue
           renderQueue();
           doSendMessage(text);
        } else {
           // High Cost -> Show Guard
           showCostModal(text, result.reason);
        }
      })
      .withFailureHandler(function(e) {
         console.error("Cost Check Failed", e);
         // Fallback: Proceed anyway or Skip? Proceed for now.
         messageQueue.shift();
         renderQueue();
         doSendMessage(text); 
      })
      .checkPdfCost(text);
  }

  function showCostModal(text, reason) {
    var modal = document.getElementById("cost-modal");
    var msg = document.getElementById("modal-msg");
    var timer = document.getElementById("modal-countdown");
    
    msg.innerText = text.substring(0, 50) + (text.length>50?"...":"");
    timer.innerText = "5";
    modal.style.display = "flex";
    
    var count = 5;
    costCheckTimer = setInterval(() => {
      count--;
      timer.innerText = count;
      if (count <= 0) {
        resolveCostCheck(false); // Auto Skip
      }
    }, 1000);
  }

  function resolveCostCheck(isAgree) {
    clearInterval(costCheckTimer);
    document.getElementById("cost-modal").style.display = "none";
    
    var currentMsg = messageQueue.shift(); // Remove pending msg
    renderQueue();
    
    if (isAgree) {
      doSendMessage(currentMsg);
    } else {
      updateLogs([`[Cost Guard] ğŸš« è‡ªå‹•è·³é ($$$): "${currentMsg}"`]);
      // Trigger next immediately
      isBotProcessing = false;
      setTimeout(processQueue, 500);
    }
  }
      function renderQueue() {
        var bar = document.getElementById("queue-bar");
        var list = document.getElementById("queue-list");
        if (messageQueue.length === 0) {
          bar.style.display = "none";
          return;
        }
        bar.style.display = "flex";
        list.innerHTML = messageQueue
          .map((t, i) => `<div class="queue-chip">${i + 1}. ${t}</div>`)
          .join("");
      }

      function doSendMessage(text) {
        isBotProcessing = true;
        addMsg("user", text);

        // ğŸ”¥ å…ˆå¯«å…¥ä¸€æ¢ã€Œæº–å‚™ç™¼é€ã€çš„æ—¥èªŒ
        var logBoxId = Math.random().toString(36).substr(2, 9);
        updateLogs([
          `[${new Date().toLocaleTimeString()}] [HTML] ç™¼é€: "${text}"`,
        ]);

        var loadingId = addMsg("bot", "Reading...");

        try {
          google.script.run
            .withSuccessHandler(function (res) {
              isBotProcessing = false;
              removeMsg(loadingId);
              if (res.logs && res.logs.length > 0) updateLogs(res.logs);

              if (res.replies && res.replies.length > 0) {
                res.replies.forEach((reply, idx) => {
                  setTimeout(() => {
                    addMsg("bot", reply);
                  }, idx * 300);
                });
              } else {
                addMsg("bot", "(ç„¡å›è¦†)");
              }
              setTimeout(processQueue, 1000);
            })
            .withFailureHandler(function (err) {
              isBotProcessing = false;
              removeMsg(loadingId);
              addMsg("bot", "âŒ Error: " + err);
              setTimeout(processQueue, 1000);
            })
            .testMessage(text, "TEST_DEV_001");
        } catch (e) {
          console.error(e);
          isBotProcessing = false;
        }
      }

      // --- å¿«é€Ÿå›è¦†è§£æ ---
      function extractQuickReplies(msgText) {
        // æª¢æŸ¥æ˜¯å¦åŒ…å«å‹è™Ÿé¸æ“‡æ¨™è¨˜ (å¦‚ ã€Œè«‹é¸æ“‡å‹è™Ÿã€æˆ–ã€Œ1ï¸âƒ£ S27...ã€)
        var quickReplies = [];

        // æ¨¡å¼ 1: æ•¸å­— emoji æ¨™è¨˜çš„é¸é … (å¦‚ 1ï¸âƒ£ 2ï¸âƒ£ 3ï¸âƒ£)
        var emojiPattern = /^([1-9]ï¸âƒ£|[\d])[\s\.]*(.+)$/gm;
        var match;
        while ((match = emojiPattern.exec(msgText)) !== null) {
          var label = match[2].trim();
          if (label.length > 0 && label.length < 50) {
            quickReplies.push(label);
          }
        }

        // æ¨¡å¼ 2: ä»¥ã€Œ1. 2. 3.ã€é–‹é ­çš„é¸é …
        if (quickReplies.length === 0) {
          var numPattern = /^(\d+)\.\s*(.+)$/gm;
          while ((match = numPattern.exec(msgText)) !== null) {
            var label = match[2].trim();
            if (label.length > 0 && label.length < 50) {
              quickReplies.push(label);
            }
          }
        }

        // åªæœ‰åœ¨æœ‰å¤šå€‹é¸é …æ‰è¿”å›å¿«é€Ÿå›è¦†
        return quickReplies.length > 1 ? quickReplies : [];
      }

      // --- UI ---
      function addMsg(role, text) {
        var chatBox = document.getElementById("chat-box");
        var id = "msg-" + new Date().getTime();
        var html = `<div class="msg-row ${role}" id="${id}">
      ${role === "bot" ? '<div class="avatar"></div>' : ""}
      <div class="msg-bubble">${text}</div>
    </div>`;
        chatBox.insertAdjacentHTML("beforeend", html);
        chatBox.scrollTop = chatBox.scrollHeight;
        return id;
      }

      function addMsgWithQuickReplies(role, text, quickReplies) {
        var chatBox = document.getElementById("chat-box");
        var id = "msg-" + new Date().getTime();
        var html = `<div class="msg-row ${role}" id="${id}">
      ${role === "bot" ? '<div class="avatar"></div>' : ""}
      <div>
        <div class="msg-bubble">${text}</div>
        ${
          quickReplies.length > 0
            ? '<div class="quick-reply-group">' +
              quickReplies
                .map(
                  (label) =>
                    `<button class="quick-reply-btn" onclick="sendMessage_Direct('${label.replace(/'/g, "\\'")}')">${label}</button>`,
                )
                .join("") +
              "</div>"
            : ""
        }
      </div>
    </div>`;
        chatBox.insertAdjacentHTML("beforeend", html);
        chatBox.scrollTop = chatBox.scrollHeight;
        return id;
      }

      function sendMessage_Direct(text) {
        var chatBox = document.getElementById("chat-box");
        addMsg("user", text);
        addToHistory(text);
        currentQuickReplies = [];

        // ğŸ”¥ å…ˆå¯«å…¥ä¸€æ¢ã€Œæº–å‚™ç™¼é€ã€çš„æ—¥èªŒ
        updateLogs([
          `[${new Date().toLocaleTimeString()}] [HTML] ç™¼é€ (å¿«é€Ÿå›è¦†): "${text}"`,
        ]);

        var loadingId = addMsg("bot", "Reading...");

        isBotProcessing = true;
        google.script.run
          .withSuccessHandler(function (res) {
            isBotProcessing = false;
            removeMsg(loadingId);
            if (res.logs && res.logs.length > 0) updateLogs(res.logs);

            if (res.replies && res.replies.length > 0) {
              res.replies.forEach((reply, idx) => {
                setTimeout(() => {
                  addMsg("bot", reply);
                }, idx * 300);
              });
            } else {
              addMsg("bot", "(ç„¡å›è¦†)");
            }
            setTimeout(processQueue, 1000);
          })
          .withFailureHandler(function (err) {
            isBotProcessing = false;
            removeMsg(loadingId);
            addMsg("bot", "âŒ Error: " + err);
            setTimeout(processQueue, 1000);
          })
          .testMessage(text, "TEST_DEV_001");
      }

      function removeMsg(id) {
        var el = document.getElementById(id);
        if (el) el.remove();
      }

      function updateLogs(logs) {
        var logBox = document.getElementById("log-box");
        logs.forEach((line) => {
          logBox.insertAdjacentHTML(
            "beforeend",
            `<div class="log-line">${line}</div>`,
          );
        });
        logBox.scrollTop = logBox.scrollHeight;
      }

      function clearSession() {
        if (!confirm("é‡ç½®æ¨¡æ“¬å™¨ï¼Ÿ")) return;
        document.getElementById("chat-box").innerHTML = "";
        document.getElementById("log-box").innerHTML = "";
        messageQueue = [];
        currentQuickReplies = [];
        renderQueue();
        isBotProcessing = false;
        google.script.run.clearTestSession("TEST_DEV_001");
      }

      function copyLogs() {
        navigator.clipboard.writeText(
          document.getElementById("log-box").innerText,
        );
        alert("Copied");
      }
      function clearLogUI() {
        document.getElementById("log-box").innerHTML = "";
      }
      function checkEnter(e) {
        if (e.key === "Enter") sendMessage();
      }
    </script>
  </body>
</html>
